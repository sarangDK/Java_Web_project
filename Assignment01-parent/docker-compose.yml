version: '3.8'

services:

  booking-service:
    image: booking-service
    ports:
      - "8094:8094"
    build:
      context: ./booking-service
      dockerfile: ./Dockerfile
    container_name: booking-service

    environment:
      SPRING_PROFILES_ACTIVE: docker
    depends_on:
      - mongodb
    networks:
      - spring



  room-service:
    build:
      context: ./room-service
      dockerfile: ./Dockerfile
    ports:
      - "8091:8090"
    environment:
      - SPRING_DATASOURCE_URL=jdbc:postgresql://postgres:5435/room-service
      - SPRING_DATASOURCE_USERNAME=admin
      - SPRING_DATASOURCE_PASSWORD=password
    depends_on:
      - postgres
    networks:
      - spring


  mongodb:
    image: mongo:latest
    container_name: Assignment01-mongodb
    ports:
      - "27027:27017"
    environment:
      - MONGO_INITDB_ROOT_USERNAME=admin
      - MONGO_INITDB_ROOT_PASSWORD=password
    volumes:
      - ./data/mongo/products:/data/db
      - ./init/mongo/mongo-init.js:/docker-entrypoint-initdb.d/mongo-init.js:ro

    networks:
      - spring

  postgres:
    image: postgres:latest
    container_name: Assignment01-postgres
    environment:
      - POSTGRES_DB=room-service
      - POSTGRES_USER=admin
      - POSTGRES_PASSWORD=password
    ports:
      - "5435:5432"
    volumes:
      - ./data/postgres:/var/lib/postgresql/data
      - ./local-docker-file/mongo/docker-entrypoint-initdb.d/mongo-init.js:/docker-entrypoint-initdb.d/mongo-init.js:ro
    networks:
      - spring

  mongo-express:
    image: mongo-express
    ports:
        - "8093:8093"
    environment:
        - ME_CONFIG_MONGODB_ADMINUSERNAME=admin
        - ME_CONFIG_MONGODB_ADMINPASSWORD=password
        - ME_CONFIG_MONGODB_SERVER=mongodb

    container_name: Assignment01-mongo-express
    depends_on:
        - mongodb
    networks:
        - spring

  pgadmin:
    image: dpage/pgadmin4
    ports:
      - "8999:90"
    container_name: Assignment01-pgadmin-single
    environment:
      - PGADMIN_DEFAULT_EMAIL=user@domain.ca
      - PGADMIN_DEFAULT_PASSWORD=password
    depends_on:
      - postgres
    networks:
      - spring
volumes:
  mongodb-db:
    driver: local

networks:
  spring:
    driver: bridge